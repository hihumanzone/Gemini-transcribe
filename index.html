<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Text Extractor - Gemini API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent: #4a9eff;
            --accent-hover: #357abd;
            --error: #ff4a4a;
            --success: #4aff88;
            --border: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            width: 100%;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, #a370f7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .upload-section {
            background-color: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: var(--accent);
            background-color: var(--bg-tertiary);
        }

        .upload-area.dragover {
            border-color: var(--accent);
            background-color: var(--bg-tertiary);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.7;
        }

        input[type="file"] {
            display: none;
        }

        .preview-section {
            margin-top: 1.5rem;
            display: none;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin: 0 auto;
            display: block;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .result-section {
            background-color: var(--bg-secondary);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
            display: none;
        }

        .result-text {
            background-color: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.95rem;
            line-height: 1.8;
        }

        .button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .button:hover {
            background-color: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
        }

        .button:active {
            transform: translateY(0);
        }

        .button-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .button-secondary:hover {
            background-color: #3a3a3a;
        }

        .settings-button {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            z-index: 100;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--bg-secondary);
            padding: 2.5rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal h2 {
            font-size: 1.5rem;
            font-weight: 400;
        }

        .close-button {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            transition: color 0.3s ease;
        }

        .close-button:hover {
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.2);
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .error-message {
            background-color: rgba(255, 74, 74, 0.1);
            color: var(--error);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
            border: 1px solid rgba(255, 74, 74, 0.3);
        }

        .success-message {
            background-color: rgba(74, 255, 136, 0.1);
            color: var(--success);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
            border: 1px solid rgba(74, 255, 136, 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 3px solid var(--bg-tertiary);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        @media (max-width: 600px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .settings-button {
                top: 1rem;
                right: 1rem;
                width: 40px;
                height: 40px;
                font-size: 1.25rem;
            }
        }
    </style>
</head>
<body>
    <button class="button settings-button" id="settingsBtn" title="Settings">‚öôÔ∏è</button>

    <div class="container">
        <header>
            <h1>Image Text Extractor</h1>
            <p class="subtitle">Extract and reformat text from images using Gemini AI</p>
        </header>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üì∑</div>
                <p>Click to upload or drag and drop an image</p>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem;">
                    Supports JPG, PNG, GIF, WebP
                </p>
                <input type="file" id="fileInput" accept="image/*">
            </div>
            <div class="preview-section" id="previewSection">
                <img class="preview-image" id="previewImage" alt="Preview">
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Processing image with Gemini AI...</p>
        </div>

        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <div class="result-section" id="resultSection">
            <h3 style="margin-bottom: 1rem;">Extracted Text</h3>
            <div class="result-text" id="resultText"></div>
            <div class="button-group">
                <button class="button" id="copyBtn">
                    <span>üìã</span> Copy Text
                </button>
                <button class="button button-secondary" id="clearBtn">
                    <span>üóëÔ∏è</span> Clear
                </button>
            </div>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-button" id="closeModal">&times;</button>
            </div>

            <div class="form-group">
                <label for="apiKey">Gemini API Key</label>
                <input type="password" id="apiKey" placeholder="Enter your Gemini API key">
                <p style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.5rem;">
                    Get your API key from <a href="https://makersuite.google.com/app/apikey" target="_blank" style="color: var(--accent);">Google AI Studio</a>
                </p>
            </div>

            <div class="form-group">
                <label for="customPrompt">Custom Prompt</label>
                <textarea id="customPrompt" placeholder="Enter your custom prompt"></textarea>
            </div>

            <button class="button" id="saveSettings" style="width: 100%;">Save Settings</button>
        </div>
    </div>

    <script>
        // Default prompt
        const DEFAULT_PROMPT = `Transcribe and rewrite the question from the image. In the process, correct any spelling, grammatical, phrasing, or formatting errors. Ensure that any equations in the rewritten version are formatted using LaTeX (e.g., $a + b = 5$). Please respond with only the final, resulting question.`;

        // DOM elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewSection = document.getElementById('previewSection');
        const previewImage = document.getElementById('previewImage');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const resultSection = document.getElementById('resultSection');
        const resultText = document.getElementById('resultText');
        const copyBtn = document.getElementById('copyBtn');
        const clearBtn = document.getElementById('clearBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const closeModal = document.getElementById('closeModal');
        const apiKeyInput = document.getElementById('apiKey');
        const customPromptInput = document.getElementById('customPrompt');
        const saveSettingsBtn = document.getElementById('saveSettings');

        // Load settings from localStorage
        let apiKey = localStorage.getItem('geminiApiKey') || '';
        let customPrompt = localStorage.getItem('customPrompt') || DEFAULT_PROMPT;

        // Initialize settings inputs
        apiKeyInput.value = apiKey;
        customPromptInput.value = customPrompt;

        // Event listeners
        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);
        copyBtn.addEventListener('click', copyText);
        clearBtn.addEventListener('click', clearAll);
        settingsBtn.addEventListener('click', () => settingsModal.style.display = 'flex');
        closeModal.addEventListener('click', () => settingsModal.style.display = 'none');
        saveSettingsBtn.addEventListener('click', saveSettings);

        // Close modal when clicking outside
        settingsModal.addEventListener('click', (e) => {
            if (e.target === settingsModal) {
                settingsModal.style.display = 'none';
            }
        });

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                previewSection.style.display = 'block';
                processImage(e.target.result);
            };
            
            reader.readAsDataURL(file);
        }

        async function processImage(base64Image) {
            if (!apiKey) {
                showError('Please set your Gemini API key in settings.');
                return;
            }

            showLoading();
            hideMessages();

            try {
                // Remove data URL prefix to get pure base64
                const base64Data = base64Image.split(',')[1];

                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-goog-api-key': apiKey
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {
                                    text: customPrompt
                                },
                                {
                                    inline_data: {
                                        mime_type: getMimeType(base64Image),
                                        data: base64Data
                                    }
                                }
                            ]
                        }]
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error?.message || 'API request failed');
                }

                if (data.candidates && data.candidates.length > 0 && data.candidates[0].content) {
                    const extractedText = data.candidates[0].content.parts[0].text;
                    displayResult(extractedText);
                } else {
                    throw new Error('No text extracted from image');
                }

            } catch (error) {
                console.error('Error:', error);
                showError(error.message || 'Failed to process image. Please check your API key and try again.');
            } finally {
                hideLoading();
            }
        }

        function getMimeType(dataUrl) {
            const match = dataUrl.match(/^data:([^;]+);/);
            return match ? match[1] : 'image/jpeg';
        }

        function displayResult(text) {
            resultText.textContent = text;
            resultSection.style.display = 'block';
            showSuccess('Text extracted successfully!');
        }

        function copyText() {
            const text = resultText.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showSuccess('Text copied to clipboard!');
            }).catch(() => {
                showError('Failed to copy text');
            });
        }

        function clearAll() {
            previewSection.style.display = 'none';
            resultSection.style.display = 'none';
            fileInput.value = '';
            hideMessages();
        }

        function saveSettings() {
            apiKey = apiKeyInput.value.trim();
            customPrompt = customPromptInput.value.trim() || DEFAULT_PROMPT;
            
            localStorage.setItem('geminiApiKey', apiKey);
            localStorage.setItem('customPrompt', customPrompt);
            
            settingsModal.style.display = 'none';
            showSuccess('Settings saved successfully!');
        }

        function showLoading() {
            loading.style.display = 'block';
        }

        function hideLoading() {
            loading.style.display = 'none';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
        }

        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
            
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        function hideMessages() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
        }
    </script>
</body>
</html>
